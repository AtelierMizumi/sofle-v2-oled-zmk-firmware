# Copyright (c) 2020 Ryan Cross
# SPDX-License-Identifier: MIT

# Enable the Sofle OLED Display
CONFIG_ZMK_DISPLAY=y
CONFIG_ZMK_DISPLAY_STATUS_SCREEN_CUSTOM=y

# Enable I2C and SSD1306 for OLED
CONFIG_I2C=y
CONFIG_SSD1306=y
CONFIG_ZMK_EXT_POWER=y

# Enable nice!oled
CONFIG_NICE_OLED_ON=y
CONFIG_NICE_EPAPER_ON=n
CONFIG_NICE_CUSTOM_ON=n

# Uncomment these two lines to add support for encoders
CONFIG_EC11=y
CONFIG_EC11_TRIGGER_OWN_THREAD=y

# Uncomment this line below to add rgb underglow / backlight support
CONFIG_ZMK_RGB_UNDERGLOW=n

# Uncomment the line below to disable external power toggling by the underglow.
# By default toggling the underglow on and off also toggles external power
# on and off. This also causes the display to turn off.
CONFIG_ZMK_RGB_UNDERGLOW_EXT_POWER=n

CONFIG_ZMK_BLE_EXPERIMENTAL_FEATURES=y

# ==============================================
# POWER MANAGEMENT & BATTERY OPTIMIZATION
# ==============================================

# Idle timeout: blank OLED after 15 minutes (900,000ms)
CONFIG_ZMK_IDLE_TIMEOUT=900000

# Enable deep sleep (disconnects BLE, ~20µA power draw)
CONFIG_ZMK_SLEEP=y
# Deep sleep after 30 minutes of inactivity (1,800,000ms)
CONFIG_ZMK_IDLE_SLEEP_TIMEOUT=1800000

# ==============================================
# NICE!OLED DISPLAY CONFIGURATION
# ==============================================

# Display thread configuration
# Use dedicated work queue to avoid blocking key scanning
CONFIG_ZMK_DISPLAY_WORK_QUEUE_DEDICATED=y
CONFIG_ZMK_DISPLAY_DEDICATED_THREAD_STACK_SIZE=2560
# Priority 5 = lower priority than key scanning (prevents input lag)
CONFIG_ZMK_DISPLAY_DEDICATED_THREAD_PRIORITY=5

# Memory pool for LVGL
CONFIG_LV_Z_MEM_POOL_SIZE=8192
CONFIG_LV_Z_VDB_SIZE=64
CONFIG_LV_DPI_DEF=148
CONFIG_LV_Z_BITS_PER_PIXEL=1
CONFIG_LV_COLOR_DEPTH_1=y

# Blank display when keyboard is idle (saves ~15-20mA OLED draw)
CONFIG_ZMK_DISPLAY_BLANK_ON_IDLE=y

# Show sleep art before blanking (visual feedback that keyboard is sleeping)
CONFIG_NICE_OLED_SHOW_SLEEP_ART_ON_IDLE=y
CONFIG_NICE_OLED_SHOW_SLEEP_ART_ON_SLEEP=y

# ==============================================
# NICE!OLED WIDGET CONFIGURATION - 32x128 VERTICAL
# ==============================================
# LEFT SIDE (Central): BT+Battery(0-16) -> Luna(25-57) -> Modifiers(65-79) -> Layer(85-95)
# RIGHT SIDE (Peripheral): Speedometer(0-50) -> Cat(60-92)
# Screen: 32x128 pixels (width x height)

# ==============================================
# CENTRAL SIDE (Left) - Vertical 32x128 layout
# ==============================================
# Layout (Y coords): BT+Battery(0-16) -> Luna(25-57) -> Modifiers(65-79) -> Layer(85-95)

# WPM Widget - Bật cho cả hai bên
CONFIG_NICE_OLED_WIDGET_WPM=y
CONFIG_NICE_OLED_WIDGET_WPM_NUMBER=n
# Bật Speedometer cho cả hai bên
CONFIG_NICE_OLED_WIDGET_WPM_SPEEDOMETER=y
CONFIG_NICE_OLED_WIDGET_WPM_LUNA=y
# Giảm tốc độ animation Luna (chậm hơn)
CONFIG_NICE_OLED_WIDGET_WPM_LUNA_ANIMATION_MS=800

# Disable Bongo Cat
CONFIG_NICE_OLED_WIDGET_WPM_BONGO_CAT=n
CONFIG_NICE_OLED_WIDGET_HID_INDICATORS_BONGO_CAT=n
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS_BONGO_CAT=n

# Modifiers - VERTICAL layout cho 4 icon đều hiển thị
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS=y
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS_FIXED=y
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS_FIXED_SYMBOL=y
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS_FIXED_BOX=n
# Đổi từ HOR sang VER để hiển thị 4 icon dọc
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS_FIXED_VER=y
CONFIG_NICE_OLED_WIDGET_MODIFIERS_INDICATORS_FIXED_SYMBOL_MACOS=n

# HID Indicators - chỉ cho Capslock, không Luna
CONFIG_NICE_OLED_WIDGET_HID_INDICATORS=y
CONFIG_ZMK_HID_INDICATORS=y
CONFIG_NICE_OLED_WIDGET_HID_INDICATORS_LUNA=n
CONFIG_NICE_OLED_WIDGET_HID_INDICATORS_LUNA_ONLY_CAPSLOCK=n

# Layer Widget
CONFIG_NICE_OLED_WIDGET_LAYER=y

# ==============================================
# PERIPHERAL SIDE (Right) - Speedometer + Cat
# ==============================================
# Layout (Y coords): Speedometer(0-50) -> Cat(60-92)

# Giữ Cat animation cho bên phải - GIẢM TỐC ĐỘ (chậm hơn)
CONFIG_NICE_OLED_WIDGET_ANIMATION_PERIPHERAL=y
CONFIG_NICE_OLED_WIDGET_ANIMATION_PERIPHERAL_CAT=y
# Tăng thờigian animation để chạy chậm hơn (960ms = chậm)
CONFIG_NICE_OLED_WIDGET_ANIMATION_PERIPHERAL_MS=960
CONFIG_NICE_OLED_WIDGET_ANIMATION_PERIPHERAL_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_ANIMATION_PERIPHERAL_CUSTOM_Y=50
# Bật WPM Graph
CONFIG_NICE_OLED_WIDGET_WPM_GRAPH=y
CONFIG_NICE_OLED_WIDGET_WPM_GRAPH_ANIMATION_MS=960
CONFIG_NICE_OLED_WIDGET_WPM_GRAPH_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_WPM_GRAPH_CUSTOM_Y=0

# TẮT các widget không cần trên bên phải
CONFIG_NICE_OLED_WIDGET_ANIMATION_PERIPHERAL_WPM=n

# ==============================================
# WIDGET POSITIONS - Optimized for 32x128
# ==============================================

# LEFT SIDE (Central) - Positions optimized:
# Row 1 (Y=0-16): BT icon + Battery (cùng hàng nhưng BT trái, Battery phải)
CONFIG_NICE_OLED_WIDGET_OUTPUT_BT_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_OUTPUT_BT_CUSTOM_Y=0
CONFIG_NICE_OLED_WIDGET_OUTPUT_USB_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_OUTPUT_USB_CUSTOM_Y=0
CONFIG_NICE_OLED_WIDGET_BATTERY_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_BATTERY_CUSTOM_Y=10

# Row 2 (Y=20-52): Luna dịch sang trái để không bị tràn (X=0 thay vì X=4)
CONFIG_NICE_OLED_WIDGET_LUNA_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_LUNA_CUSTOM_Y=20

# Row 3 (Y=55-110): Modifiers VERTICAL (4 icons dọc)
CONFIG_NICE_OLED_WIDGET_MODIFIERS_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_MODIFIERS_CUSTOM_Y=55

# Row 4 (Y=112-122): Layer name
CONFIG_NICE_OLED_WIDGET_LAYER_CUSTOM_X=0
CONFIG_NICE_OLED_WIDGET_LAYER_CUSTOM_Y=112

# Output background on central and peripheral
CONFIG_NICE_OLED_WIDGET_OUTPUT_BACKGROUND=n

# Invert display colors (for dark mode)
CONFIG_NICE_OLED_WIDGET_INVERTED=n
